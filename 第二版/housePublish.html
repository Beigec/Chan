<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>话题</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/buijs/lib/latest/bui.css">
    <script src="https://cdn.jsdelivr.net/npm/buijs/lib/zepto.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/buijs/lib/latest/bui.js"></script>
    <style></style>
</head>
<body>
<style>
    .publish-mark {
        position:fixed;
        right: 20px;
        bottom: 60px;
        width: 60px;
        height: 60px;
        line-height: .8rem;
        text-align: center;
        background-color: #26d76d;
        -webkit-border-radius: 50%;
        -moz-border-radius: 50%;
        border-radius: 50%;
    }

    .publish-mark i {
        font-size: .24rem;
        text-align: center;
        color: #fff;
    }
    .page-form .bui-fluid-space-3 .span1 {
        margin-bottom: .2rem;
    }
    .selected-val {
        margin-right: .1rem;
    }
    output {
        word-break: break-all;
    }

    .bui-box-space {
        margin-bottom: .2rem;
    }
</style>
<div class="bui-page" id="page">
    <header class="bui-bar">
        <div class="bui-bar-left"> 	<a class="bui-btn" onclick="bui.back();"><i class="icon-back"></i></a> </div>
        <div class="bui-bar-main">信息发布表单</div>
        <div class="bui-bar-right"> </div>
    </header>
    <main>
        <!-- / -->
        <h1 class="section-title">请填写你的房源信息</h1>
        <ul class="bui-list">
            <li class="bui-list">
            <li class="bui-btn bui-box">
                <label class="bui-label">类型</label>
                <div class="span1"> </div>
                <div id="rentype" class="bui-select">请选择 </div> <i class="icon-listright"></i>
            </li>
            <li class="bui-btn bui-box">
                <label class="bui-label">性別</label>
                <div class="span1"> </div>
                <div id="sex" class="bui-select">请选择 </div> <i class="icon-listright"></i>
            </li>
            </li>
        </ul>
        <ul class="bui-list">
            <li class="bui-btn bui-box">
                <label class="bui-label">所在城市</label>
                <div class="span1"> </div>
                <div id="selectCity" class="bui-select">请选择 </div> <i class="icon-listright"></i>
            </li>
        </ul>
        <ul class="bui-list">
            <li class="bui-btn bui-box">
                <label class="bui-label">区域</label>
                <div class="span1"></div>
                <div id="selectArea" class="bui-select">请选择 </div> <i class="icon-listright"></i>

            </li>
        </ul>
        <ul class="bui-list">
            <li class="bui-btn bui-box clearactive">
                <label class="bui-label" for="address">详细地址</label>
                <div class="span1">
                    <div class="bui-input user-input">
                        <input id="address" type="text" value="" placeholder="" maxlength="16"> </div>
                </div>
            </li>

            <ul class="bui-btn bui-box clearactive">
                <label class="bui-label" for="cash">租金</label>
                <div class="span1">
                    <div class="bui-input user-input">
                        <input id="cash" type="text" value="" placeholder="元/月" maxlength="16"> </div>
                </div>
            </ul>
            <ul class="bui-btn bui-box clearactive">
                <label class="bui-label" for="phone">联系方式</label>
                <div class="span1">
                    <div class="bui-input user-input">
                        <input id="phone" type="text" value="" placeholder="666" maxlength="16"> </div>
                </div>
            </ul>


        </ul>

        <ul class="bui-btn bui-box clearactive">
            <label class="bui-label" for="label">公司标签</label>
            <div class="span1">
                <div class="bui-input user-input">
                    <input id="label" type="text" value="" placeholder="输入公司标签(##标签1##标签2##标签3)" maxlength="16"> </div>
            </div>
        </ul>

        <ul class="bui-btn bui-box clearactive">
            <label class="bui-label" for="title">房源标题</label>
            <div class="span1">
                <div class="bui-input user-input">
                    <input id="title" type="text" value="" placeholder="输入房源标题" maxlength="16"> </div>
            </div>
        </ul>
        <ul class="bui-list">
            <li class="bui-btn clearactive">
                <div class="bui-input">
                    <textarea class="bui-input" cols="30" rows="4" placeholder="请输入内容" id="commentContent" ></textarea>
                </div>
            </li>
        </ul>
        <!-- / -->



        <!-- 上传示例 -->
        <div class="section-title">
            上传简历:
        </div>
        <div id="buiPhoto" class="bui-upload bui-fluid-space-4">
            <div class="span1">
                <div id="btnUpload" class="bui-btn">
                    <i class="icon-plus large"></i>
                </div>
            </div>
        </div>

        <!-- 操作示例 -->
        <div class="container-y">


            <div class="bui-box-space">
                <div class="span1">
                    <div class="bui-btn info" id="upload">发布话题</div>
                </div>

            </div>
        </div>

    </main>
    <footer>
        <!-- tab菜单结构 -->
        <ul id="tabDynamicNav" class="bui-nav">
            <li class="bui-btn bui-box-vertical" href="http://localhost:8080/vio_war/page/in.html"><i class="icon-chat"></span></i>
                <div class="span1">招聘</div>
            </li>
            <li class="bui-btn bui-box-vertical" href="http://localhost:8080/vio_war/page/rent.html"><i class="icon-face"></span></i>
                <div class="span1">求租</div>
            </li>
            <li class="bui-btn bui-box-vertical" href="http://localhost:8080/vio_war/page/house.html"><i class="icon-home"></span></i>
                <div class="span1">房源</div>
            </li>

            <li class="bui-btn bui-box-vertical   active" href="http://localhost:8080/vio_war/page/topic.html"><i class="icon-edit"></i>
                <div class="span1">社区</div>
            </li>

            <li class="bui-btn bui-box-vertical" href="http://localhost:8080/vio_war/page/personal.html"><i class="icon-setting"></i>
                <div class="span1">我的</div>
            </li>
        </ul>
    </footer>
</div>
<script>
    var city,area;
    levelSelect();
    bui.ready(function(){


        // 手机号,帐号是同个样式名, 获取值的时候,取的是最后一个focus的值
        var userInput = bui.input({
            id: ".user-input",
            callback: function(e) {
                // 清空数据
                this.empty();
            }
        })
        var uirent=bui.select({
            trigger: "#rentype",
            title: "请选择类型",
            type: "radio",
            data: [{
                "name": "不限",
                "value": 3
            }, {
                "name": "合租",
                "value": 1
            }, {
                "name": "整租",
                "value": 2
            }]})

        var uisex=bui.select({
            trigger: "#sex",
            title: "请选择性别",
            type: "radio",
            data: [{
                "name": "男",
                "value": 1
            }, {
                "name": "女",
                "value": 2
            }]
        })




        // 评论字数
        var comment = bui.input({
            id: "#commentContent",
            showLength: true,
            showIcon: false,
            maxLength: 400
        })


        // 拍照上传
        var $facePhoto = $("#buiPhoto");
        var $uploadBtn = $("#btnUpload").parent();

        var uiUpload = bui.upload({
            showProgress: false
        });

        // 上拉菜单 js 初始化:
        var uiActionsheet = bui.actionsheet({
            trigger: "#btnUpload",
            buttons: [{ name: "拍照上传", value: "camera" }, { name: "从相册选取", value: "photo" }],
            callback: function(e) {
                var ui = this;
                var val = $(e.target).attr("value");

                switch (val) {
                    case "camera":
                        ui.hide();
                        uiUpload.add({
                            "from": "camera",
                            "needCompress": true, // 1.5.3新增压缩
                            "width": 300,
                            "destinationType": "file", //  file | blob | data
                            "onSuccess": function(val, data) {
                                // 展示base64本地图片 建议直接调用start方法上传以后再展示远程地址,避免应用崩溃
                                this.toBase64({
                                    onSuccess: function(url) {
                                        $uploadBtn.before(templatePhoto(url))
                                    }
                                });

                            }
                        })

                        break;
                    case "photo":
                        ui.hide();
                        uiUpload.add({
                            "from": "",
                            "onSuccess": function(val, data) {

                                // 展示base64本地图片 建议直接调用start方法上传以后再展示远程地址,避免应用崩溃
                                this.toBase64({
                                    onSuccess: function(url) {
                                        $uploadBtn.before(templatePhoto(url))

                                    }
                                });

                            }
                        })

                        break;
                    case "cancel":
                        ui.hide();
                        break;
                }
            }
        })

        function templatePhoto(url) {
            return `<div class="span1" data-index="${uiUpload.currentIndex()}" data-name="${uiUpload.currentName()}">
                <div class="bui-upload-thumbnail"><img src="${url}" alt="" /><i class="icon-removefill"></i></div>
            </div>`
        }


        // 上传图片
        $("#upload").on("click", function(argument) {


            var houseType=uirent.value();
            if(houseType==3)houseType=0;
            var sex=uisex.value();
            var address=$("#address").val();
            var rental=$("#cash").val();
            var contact=$("#phone").val();
            var topic=$("#title").val();
            var label=$("#label").val();
            var note=$("#commentContent").val();
            console.log(city);
            console.log(area);
            uiUpload.startAll({
                // url: "http://eid.bingosoft.net:83/share/apis/upload/image",
                url: "http://localhost:8080/vio_war/house/add/house",
                // url: "https://www.swla.com.cn/demo/upload.asp",
                // url:"http://10.201.78.23:81/dataservice.ashx?CommandName=Atd$ImgUpLoad",
/*                data: {
                    'city':city,
                    'houseType':houseType,
                    'area':area,
                    'rental':rental,
                    'contact':contact,
                    'topic':topic,
                    'note':note,
                    'label':label,
                    'sex':sex,
                    'address':address
                },*/
                data: {
                    'city':city,
                    'houseType':houseType,
                    'rental':rental,
                    'contact':contact,
                    'topic':topic,
                    'note':note,
                    'label':label,
                    'sex':sex,
                    'address':address
                },
                onSuccess: function(data) {
                    console.log(data)
                    bui.alert("发布成功！")
                },
                onFail: function(data) {
                    bui.alert("发布失败，请检查是否登录")
                }
            })

        })
        // 停止上传
        $("#stopUpload").on("click", function(argument) {

            uiUpload.stop();

        })
        bui.btn({
            id:"#page",
            handle: ".bui-btn"  // 绑定多个 ".bui-btn,.submit,a"
        }).load();

    })

    function levelSelect() {
        var uiMask = bui.mask();
        /* 一, 初始化控件 */

        // 城市的数据
        var chineseCities = {};
        var uiLoading = bui.loading();


        var citySelect = bui.select({
            trigger: "#selectCity",
            title: "请选择地市",
            type: "radio",
            height: 300,
            autoClose: true,
            field: {
                value: "name"
            },
            data: []
        });

        // 地区
        var areaSelect = bui.select({
            trigger: "#selectArea",
            title: "请选择区域",
            type: "radio",
            height: 300,
            autoClose: true,
            field: {
                value: "name"
            },
            data: []
        });



        var datas={"data":[
                {"name":"北京","area":["东城区","西城区","崇文区","宣武区","朝阳区","丰台区","石景山区","海淀区","门头沟区","房山区","通州区","顺义区","昌平区","大兴区","平谷区","怀柔区","密云县","延庆县"]},
                {"name":"上海", "area":["黄浦区","卢湾区","徐汇区","长宁区","静安区","普陀区","闸北区","虹口区","杨浦区","宝山区","闵行区","嘉定区","松江区","金山区","青浦区","南汇区","奉贤区","浦东新区","崇明县"]},
                {"name":"深圳", "area":["福田区","罗湖区","南山区","宝安区","龙岗区","盐田区"]},
                {"name":"广州", "area":["越秀区","荔湾区","海珠区","天河区","白云区","黄埔区","番禺区","花都区","南沙区","萝岗区","增城市","从化市"]}
            ]}
        uiLoading.show();
        chineseCities.city=datas.data;
        citySelect.option("data",datas.data)
        uiLoading.hide();

        /* 二, 监听控件的事件变化 */

        citySelect.on("change",function(){
            var index =citySelect.index()||0;
            chineseCities.area=chineseCities.city[index]["area"];
            areaSelect.option("data",chineseCities.area)
            areaSelect.show("none");
            city = citySelect.text();
        });
        areaSelect.on("change",function(){

            area = areaSelect.text();
            address = "";


            address =city + area;

            // 输出地址
            console.log(address);

        })

    }


</script>
</body>
</html>